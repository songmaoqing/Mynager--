﻿<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<title>会议管理</title>
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/base.css">
	<script type="text/javascript" src="/js/base.js"></script>
	<script type="text/javascript" src="/js/jquery-3.1.0.min.js"></script>
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/3rd/swig.js"></script>
</head>
<body>
<div id="container">
	<div id="header">
		<ul class="nav navbar-nav">
			<li><a href="/user/homepage"><span class="glyphicon glyphicon-home"> 主页</span></a></li>
		</ul>
		<b>会议管理</b>
		<div class="clear"></div>
	</div>
	<div class="section">
		<div class="section_header">会议批准</div>
		<div class="list" id="meeting_lists1"></div>
	</div>
	<div class="section">
		<div class="section_header">会议搜索与管理</div>
		<div class="list" id="meeting_list2"></div>
	</div>
</div>
</body>
<script type="text/template" id="tpl-meeting_lists1">
    {% for meet in meetings %}
    <div class="item">
        <div class="item_name"><p>{{ meet.name }}</p></div>
        <div class="item_intro"><p>{{ meet.description }}</p></div>
        <div class="item_note"><p>{{ meet.organizer }}</p></div>
        <div class="btn-group item_btn">
            <button type="button" class="btn btn-default" onclick="window.open('/meeting/detail?id={{ meet.id }}')">查看详情</button>
            <button type="button" class="btn btn-default" onclick="Allow({{ meet.id }})">同意</button>
            <button type="button" class="btn btn-default" data-toggle="modal" data-target="#reject_input_{{ meet.id }}">拒绝</button>
        </div>
        <div class="clear"></div>
    </div>
    <div class="modal fade" id="reject_input_{{ mmet_id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" align="center">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">请输入理由</h4>
            </div>
            <textarea class="yinputtext" rows="5" placeholder="最多输入150字" maxlength=150></textarea>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary">提交更改</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
    {% endfor %}
</script>
<script type="text/template" id="tpl-meeting_list2">
    {% for meet in meetings %}
    <div class="item">
        <div class="item_name"><p>{{ meet.name }}</p></div>
        <div class="item_intro"><p>{{ meet.description }}</p></div>
        <div class="item_note"><p>
            {% if meet.status == -1 %}
            停止
            {% elif meet.status == -2 %}
            拒绝
            {% elif meet.status == 1 %}
            正常
            {% endif %}
        </p></div>
        <div class="btn-group item_btn">
            <button type="button" class="btn btn-default" onclick="window.open('/meeting/detail?id={{ meet.id }}')">查看详情</button>
            <button type="button" class="btn btn-default" onclick="Change({{ meet.id }}, {{ meet.status }})">
            {% if meet.status == -1 %}
            恢复
            {% elif meet.status == -2 %}
            同意
            {% elif meet.status == 1 %}
            停止
            {% endif %}
            </button>
            <button type="button" class="btn btn-default">删除</button>
        </div>
        <div class="clear"></div>
    </div>
    {% endfor %}
</script>
<script type="text/javascript">
    var page_index = 0, meetings, meetings1, meeting_num = 6;
    function GetAllList(index, stat) {
        api.get('/api/u/meeting/list', {"meeting_num": meeting_num, "page_index": index, "status": stat}, function (data) {
            //status:状态, total_page:总页数, list:会议信息列表
            if (data[status] == false) {
                alert("获取会议列表错误，可能该页会议不存在！");
                return;
            }
            page_index = index;
            meetings = data["list"];
            //("#page_nums").html(swig.render($("#tpl-page_nums").html(), { page_index }));
            if(stat == 0)
                $("#meeting_lists1").html(swig.render($("#tpl-meeting_lists1").html(), { meetings }));
            else
                $("#meeting_list2").html(swig.render($("#tpl-meeting_list2").html(), { meetings }));
        }, dftFail);
    }
    function Allow(meet_id) {
        //console.log(meet_id);
        api.post("/api/u/meeting/detail", { "meeting_id": meet_id, "status": 1 }, function (data) {
            alert("该会议已经被批准举行！");
            window.location.reload(true);
        }, dftFail);
    }
    function Change(meet_id, stat) {
        var type = -1;
        if(stat == 1)
                type = -1;
        else
                type = 1;
        api.post("/api/u/meeting/detail", { "meeting_id": meet_id, "status": type }, function (data) {
            if(type == -1)
                alert("该会议已经被停止举行！");
            else
                    alert("该会议已经被批准进行！");
            window.location.reload(true);
        }, dftFail);
    }
    $(function () {
        GetAllList(1, 0);
        GetAllList(1, 1);
    })
</script>
</html>